
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E🍷%3C/text%3E%3C/svg%3E">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>World Wine News</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #111827;
      }
      /* Simple scrollbar styling for a more modern look */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #111827; /* bg-gray-900 */
      }
      ::-webkit-scrollbar-thumb {
        background: #4b5563; /* bg-gray-600 */
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #6b7280; /* bg-gray-500 */
      }
       .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "@google/genai": "https://esm.sh/@google/genai@0.14.0"
      }
    }
    </script>
</head>
<body class="bg-gray-900">
    <div id="root"></div>
    <script type="module">
        import React, { useState, useEffect, useCallback, StrictMode } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI, Type } from "@google/genai";

        // --- TYPE DEFINITIONS ---
        // Originally from types.ts
        /*
        interface Article {
          koreanTitle: string;
          koreanSummary: string;
          sourceName: string;
          originalUrl: string;
        }
        */

        // --- GEMINI SERVICE ---
        // Originally from services/geminiService.ts
        const newsSchema = {
            type: Type.ARRAY,
            items: {
                type: Type.OBJECT,
                properties: {
                    koreanTitle: {
                        type: Type.STRING,
                        description: 'The title of the article, translated into Korean.',
                    },
                    koreanSummary: {
                        type: Type.STRING,
                        description: 'A brief 2-3 sentence summary of the article, translated into Korean.',
                    },
                    sourceName: {
                        type: Type.STRING,
                        description: 'The name of the source publication, e.g., "Wine Spectator".',
                    },
                    originalUrl: {
                        type: Type.STRING,
                        description: 'The direct URL to the original article.',
                    },
                },
                required: ["koreanTitle", "koreanSummary", "sourceName", "originalUrl"],
            },
        };

        const fetchWineNews = async (apiKey) => {
            if (!apiKey) {
              throw new Error("API Key is missing.");
            }
            const ai = new GoogleGenAI({ apiKey });
            try {
                const prompt = `
                  You are an expert wine news curator. Your task is to find the 30 most recent and significant news articles about the global wine industry from top-tier, reputable publications.
                  Examples of such publications include: The Drinks Business, Wine Spectator, JamesSuckling.com, Robert Parker Wine Advocate, Decanter, JancisRobinson.com, etc.
                  
                  For each article, provide the following information:
                  1.  A title translated into Korean.
                  2.  A brief 2-3 sentence summary translated into Korean.
                  3.  The name of the source publication.
                  4.  A valid, direct URL to the original article.

                  Return the entire response as a single, valid JSON array of 30 objects, conforming to the provided schema. Ensure URLs are complete and correct.
                `;

                const response = await ai.models.generateContent({
                    model: "gemini-2.5-flash",
                    contents: prompt,
                    config: {
                        responseMimeType: "application/json",
                        responseSchema: newsSchema,
                        temperature: 0.5,
                    },
                });
                
                const jsonText = response.text.trim();
                const articles = JSON.parse(jsonText);

                if (!Array.isArray(articles)) {
                    throw new Error("API did not return a valid array.");
                }

                return articles;
            } catch (error) {
                console.error("Error fetching or parsing wine news:", error);
                let errorMessage = "Gemini API로부터 뉴스 데이터를 가져오는데 실패했습니다. API 키가 유효한지 확인해주세요.";
                if (error instanceof Error) {
                    errorMessage += ` Details: ${error.message}`;
                }
                throw new Error(errorMessage);
            }
        };

        // --- COMPONENTS ---

        // Originally from components/LoadingSpinner.tsx
        const LoadingSpinner = () => (
            <div className="flex flex-col items-center justify-center h-96 text-gray-400">
                <svg className="animate-spin -ml-1 mr-3 h-10 w-10 text-cyan-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p className="mt-4 text-lg">최신 와인 뉴스를 불러오는 중입니다...</p>
                <p className="text-sm">Gemini AI가 기사를 선별하고 번역하고 있습니다.</p>
            </div>
        );

        // Originally from components/ErrorDisplay.tsx
        const ErrorDisplay = ({ message, onRetry }) => (
            <div className="flex flex-col items-center justify-center h-96 text-red-400 bg-red-900/20 rounded-lg p-6">
                <div className="w-16 h-16 text-red-500 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                </div>
                <p className="text-lg font-bold mb-2">오류가 발생했습니다</p>
                <p className="text-center text-red-300 mb-6 max-w-md">{message}</p>
                <button
                    onClick={onRetry}
                    className="px-6 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors"
                >
                    다시 시도
                </button>
            </div>
        );

        // Originally from components/Header.tsx
        const Header = ({ lastUpdated, isUpdating }) => {
            const formatTime = (date) => {
                if (!date) return '불러오는 중...';
                return date.toLocaleTimeString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                });
            };

            return (
                <header className="bg-gray-900/70 backdrop-blur-lg sticky top-0 z-10 border-b border-gray-700">
                    <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-20">
                            <div className="flex-shrink-0">
                                <h1 className="text-2xl sm:text-3xl font-bold text-white tracking-tight">
                                    <span role="img" aria-label="wine glass" className="mr-2">🍷</span>
                                    세계 와인 뉴스
                                </h1>
                                <p className="text-sm text-gray-400">World Wine News</p>
                            </div>
                            <div className="text-right">
                                <p className="text-sm text-gray-400">마지막 업데이트</p>
                                <div className="flex items-center justify-end">
                                    {isUpdating && (
                                        <div className="w-4 h-4 border-2 border-dashed rounded-full animate-spin border-green-400 mr-2"></div>
                                    )}
                                    <p className={`text-base font-medium ${isUpdating ? 'text-green-400' : 'text-white'}`}>
                                        {isUpdating ? '업데이트 중...' : formatTime(lastUpdated)}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Originally from components/NewsCard.tsx
        const NewsCard = ({ article, index }) => {
            const { koreanTitle, koreanSummary, sourceName, originalUrl } = article;
            const imageUrl = `https://picsum.photos/seed/${encodeURIComponent(sourceName)}/${index}/400/250`;

            return (
                <a
                    href={originalUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="group flex flex-col bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-cyan-500/30 transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105 fade-in"
                    style={{ animationDelay: `${index * 50}ms` }}
                >
                    <div className="relative">
                        <img className="w-full h-48 object-cover" src={imageUrl} alt="Wine News" loading="lazy" />
                        <div className="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors duration-300"></div>
                    </div>
                    <div className="p-6 flex flex-col flex-grow">
                        <p className="text-sm font-semibold text-cyan-400 mb-1">{sourceName}</p>
                        <h3 className="text-lg font-bold text-gray-100 mb-2 leading-snug flex-grow">
                            {koreanTitle}
                        </h3>
                        <p className="text-gray-400 text-sm leading-relaxed mb-4">
                            {koreanSummary}
                        </p>
                        <div className="mt-auto text-right text-sm font-medium text-cyan-300 group-hover:text-cyan-200">
                            기사 원문 보기 &rarr;
                        </div>
                    </div>
                </a>
            );
        };

        // Originally from App.tsx
        const App = ({ apiKey }) => {
            const [articles, setArticles] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState(null);
            const [lastUpdated, setLastUpdated] = useState(null);

            const fetchData = useCallback(async () => {
                setIsLoading(true);
                setError(null);
                try {
                    const newsArticles = await fetchWineNews(apiKey);
                    setArticles(newsArticles);
                    setLastUpdated(new Date());
                } catch (err) {
                    setError(err.message || '알 수 없는 오류가 발생했습니다.');
                    console.error(err);
                } finally {
                    setIsLoading(false);
                }
            }, [apiKey]);

            useEffect(() => {
                fetchData();
                const intervalId = setInterval(fetchData, 3600 * 1000); // 1 hour
                return () => clearInterval(intervalId);
            }, [fetchData]);

            const renderContent = () => {
                if (isLoading && articles.length === 0) {
                    return <LoadingSpinner />;
                }
                if (error) {
                    return <ErrorDisplay message={error} onRetry={fetchData} />;
                }
                if (articles.length === 0 && !isLoading) {
                    return <div className="text-center text-gray-400 mt-10">뉴스를 불러오지 못했습니다. 잠시 후 다시 시도해 주세요.</div>;
                }
                return (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                        {articles.map((article, index) => (
                            <NewsCard key={`${article.originalUrl}-${index}`} article={article} index={index} />
                        ))}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-200 font-sans">
                    <Header lastUpdated={lastUpdated} isUpdating={isLoading && articles.length > 0} />
                    <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {renderContent()}
                    </main>
                    <footer className="text-center py-6 text-gray-500 text-sm">
                        <p>Powered by Google Gemini. News curated for wine lovers.</p>
                    </footer>
                </div>
            );
        };
        
        // --- API KEY MANAGER & RENDERER ---
        // New component to handle API Key input
        const ApiKeyManager = () => {
            const [apiKey, setApiKey] = useState(() => sessionStorage.getItem('gemini-api-key'));
            const [tempKey, setTempKey] = useState('');
            const [error, setError] = useState('');

            const handleSaveKey = (e) => {
                e.preventDefault();
                if (!tempKey.trim()) {
                    setError('API 키를 입력해주세요.');
                    return;
                }
                sessionStorage.setItem('gemini-api-key', tempKey);
                setApiKey(tempKey);
                setError('');
            };

            if (apiKey) {
                return <App apiKey={apiKey} />;
            }

            return (
                <div className="flex items-center justify-center min-h-screen bg-gray-900">
                    <div className="w-full max-w-md p-8 space-y-6 bg-gray-800 rounded-lg shadow-lg">
                        <div className="text-center">
                            <h1 className="text-3xl font-bold text-white">
                                <span role="img" aria-label="wine glass" className="mr-2">🍷</span>
                                세계 와인 뉴스
                            </h1>
                            <p className="mt-2 text-gray-400">시작하려면 Gemini API 키를 입력하세요.</p>
                        </div>
                        <form onSubmit={handleSaveKey} className="space-y-4">
                            <div>
                                <label htmlFor="apiKey" className="block text-sm font-medium text-gray-300">
                                  Google Gemini API Key
                                </label>
                                <input
                                    id="apiKey"
                                    type="password"
                                    value={tempKey}
                                    onChange={(e) => setTempKey(e.target.value)}
                                    className="w-full px-3 py-2 mt-1 text-gray-200 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"
                                    placeholder="API 키를 여기에 붙여넣으세요"
                                    required
                                />
                            </div>
                            {error && <p className="text-sm text-red-400">{error}</p>}
                             <p className="text-xs text-gray-500">
                                API 키는 브라우저 세션에만 저장되며 서버로 전송되지 않습니다.
                                <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className="text-cyan-400 hover:underline ml-1">
                                    여기서 키 받기
                                </a>
                            </p>
                            <button
                                type="submit"
                                className="w-full px-4 py-2 font-semibold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-cyan-500 transition-colors"
                            >
                                저장하고 시작하기
                            </button>
                        </form>
                    </div>
                </div>
            );
        };


        // Originally from index.tsx
        const rootElement = document.getElementById('root');
        if (!rootElement) {
            throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
            <StrictMode>
                <ApiKeyManager />
            </StrictMode>
        );
    </script>
</body>
</html>
