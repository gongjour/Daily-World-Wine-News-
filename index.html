  const wineNews = window.wineNews || [
    {
      title: "2024년 보르도 와인 가격, 역사적 상승세 기록",
      excerpt: "프랑스 보르도 지역의 2024년 와인 가격이 역사적 상승세…",
      source: "Wine Spectator",
      readCount: "15,420",
      image: "https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?auto=format&fit=crop&w=1200&q=80",
      url: "https://www.winespectator.com/articles/bordeaux-2024-prices-historic-rise"
    },
    {
      title: "이탈리아 토스카나, 유기농 와인 생산 비율 40% 돌파",
      excerpt: "이탈리아 토스카나 지역에서 유기농 와인 생산 비율이 40%…",
      source: "Decanter",
      readCount: "12,890",
      image: "https://images.unsplash.com/photo-1553361371-9b22f78e8b8d?auto=format&fit=crop&w=1200&q=80",
      url: "https://www.decanter.com/wine-news/tuscany-organic-wine-production-40-percent"
    }
  ];

  // ─────────────────────────────────────────────────────────────
  // 도메인별 기본 이미지(기사 image 없을 때 사용)
  const fallbackImagesByDomain = {
    "winespectator.com": "https://images.unsplash.com/photo-1524592937423-1f4f0c2f9c54?auto=format&fit=crop&w=1200&q=80",
    "decanter.com": "https://images.unsplash.com/photo-1505751172876-fa1923c5c528?auto=format&fit=crop&w=1200&q=80",
    "thedrinksbusiness.com": "https://images.unsplash.com/photo-1578662996442-48f60103fc96?auto=format&fit=crop&w=1200&q=80",
    "robertparker.com": "https://images.unsplash.com/photo-1553361371-9b22f78e8b8d?auto=format&fit=crop&w=1200&q=80",
    "jamessuckling.com": "https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?auto=format&fit=crop&w=1200&q=80",
    "jancisrobinson.com": "https://images.unsplash.com/photo-1528821154947-1aa3d1d43c66?auto=format&fit=crop&w=1200&q=80",
    "burghound.com": "https://images.unsplash.com/photo-1528820600400-78fcdfe2a8da?auto=format&fit=crop&w=1200&q=80",
    "gamberorossointernational.com": "https://images.unsplash.com/photo-1500904151862-8596f1d05eff?auto=format&fit=crop&w=1200&q=80",
    "guide.michelin.com": "https://images.unsplash.com/photo-1509057199576-632a47484ece?auto=format&fit=crop&w=1200&q=80"
  };

  function getHomepage(url) {
    try {
      const u = new URL(url);
      return u.origin;
    } catch {
      return "#";
    }
  }

  function pickImage(news) {
    if (news.image && news.image.trim()) return news.image;
    try {
      const domain = new URL(news.url).hostname.replace(/^www\./, "");
      if (fallbackImagesByDomain[domain]) return fallbackImagesByDomain[domain];
    } catch {}
    return "https://images.unsplash.com/photo-1524592937423-1f4f0c2f9c54?auto=format&fit=crop&w=1200&q=80";
  }

  // ★★★ 중첩 <a> 제거: 카드 자체는 div로 두고 JS로 클릭 이동
  function createNewsCard(news) {
    const homepage = getHomepage(news.url || "#");
    const imgUrl = pickImage(news);

    return `
      <div class="news-card" data-url="${news.url || "#"}" role="button" tabindex="0" aria-label="기사로 이동: ${news.title}">
        <div class="news-image" style="background-image: url('${imgUrl}')">
          <i class="fas fa-wine-glass-alt"></i>
        </div>
        <div class="news-content">
          <span class="news-source">
            <a class="source-link" href="${homepage}" target="_blank" rel="noopener noreferrer" style="color:#fff;text-decoration:none;">
              ${news.source} 홈페이지
            </a>
          </span>
          <h3 class="news-title">${news.title}</h3>
          <p class="news-excerpt">${news.excerpt}</p>
          <div class="news-meta">
            <span class="read-count"><i class="fas fa-eye"></i> ${news.readCount} 읽음</span>
            <span>${getRandomTime()}</span>
          </div>
        </div>
      </div>
    `;
  }

  function getRandomTime() {
    const h = Math.floor(Math.random() * 24);
    const m = Math.floor(Math.random() * 60);
    return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
  }

  function updateLastUpdateTime() {
    const now = new Date();
    const timeString = now.toLocaleString('ko-KR', {
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit'
    });
    const el = document.getElementById('lastUpdate');
    if (el) el.textContent = `마지막 업데이트: ${timeString}`;
  }

  function displayNews() {
    const container = document.getElementById('newsContainer');
    if (!container) return;

    if (!Array.isArray(wineNews) || wineNews.length === 0) {
      container.innerHTML = `
        <div class="loading">
          <p>표시할 뉴스가 없습니다. wineNews 배열을 확인하세요.</p>
        </div>`;
      return;
    }

    const sorted = [...wineNews].sort((a, b) => {
      const an = Number(String(a.readCount || "0").replace(/,/g, ""));
      const bn = Number(String(b.readCount || "0").replace(/,/g, ""));
      return bn - an;
    });

    container.innerHTML = sorted.map(createNewsCard).join("");

    // 카드 클릭 이벤트(캡처링/버블링 최소화)
    container.querySelectorAll(".news-card").forEach(card => {
      const url = card.getAttribute("data-url");
      card.addEventListener("click", () => {
        if (url && url !== "#") window.open(url, "_blank", "noopener");
      });
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          if (url && url !== "#") window.open(url, "_blank", "noopener");
        }
      });
    });

    // 소스 링크 클릭 시 카드 클릭 전파 막기
    container.querySelectorAll(".source-link").forEach(link => {
      link.addEventListener("click", (e) => e.stopPropagation());
    });
  }

  function refreshNews() {
    wineNews.forEach(item => {
      const base = Number(String(item.readCount || "0").replace(/,/g, "")) || 0;
      const delta = Math.floor(Math.random() * 200);
      item.readCount = (base + delta).toLocaleString("ko-KR");
    });
    updateLastUpdateTime();
    displayNews();
  }

  document.addEventListener("DOMContentLoaded", function() {
    updateLastUpdateTime();
    displayNews();

    // 30분마다 자동 업데이트
    setInterval(refreshNews, 1800000);
  });
</script>
